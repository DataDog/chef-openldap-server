# Database settings
dn: olcDatabase=hdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: {1}hdb
olcDbDirectory: <%= node['openldap-server'][:db_dir] %>
olcSuffix: <%= node['openldap-server'][:domain_suffix] %>
olcLastMod: TRUE
olcRootDN: <%= node['openldap-server'][:rootDN] %>
olcRootPW: <%= node['openldap-server'][:rootpw] %>
olcDbCheckpoint: 512 30
olcDbConfig: set_cachesize 0 2097152 0
olcDbConfig: set_lk_max_objects 1500
olcDbConfig: set_lk_max_locks 1500
olcDbConfig: set_lk_max_lockers 1500
olcDbIndex: objectClass eq
olcDbIndex: uid eq,pres,sub

dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulePath: /usr/lib/ldap
olcModuleLoad: memberof

dn: olcOverlay=memberof,olcDatabase={1}hdb,cn=config
objectClass: olcMemberOf
objectClass: olcOverlayConfig
objectClass: olcConfig
objectClass: top
olcOverlay: memberof
olcMemberOfDangling: ignore
olcMemberOfRefInt: TRUE
olcMemberOfGroupOC: groupOfNames
olcMemberOfMemberAD: member
olcMemberOfMemberOfAD: memberOf

dn: <%= node['openldap-server'][:domain_suffix] %>
objectClass: top
objectClass: dcObject
objectClass: organization
o: corp

dn: ou=People,<%= node['openldap-server'][:domain_suffix] %>
objectClass: organizationalUnit
ou: People

dn: ou=Groups,<%= node['openldap-server'][:domain_suffix] %>
objectClass: organizationalUnit
ou: Groups

dn: ou=Services,<%= node['openldap-server'][:domain_suffix] %>
objectClass: organizationalUnit
ou: Services

dn: olcDatabase={1}hdb,cn=config
changetype: modify
add: olcAccess
olcAccess: to attrs=userPassword by dn="<%= node['openldap-server'][:rootDN] %>" write by anonymous auth by self write by * none
olcAccess: to attrs=shadowLastChange by self write by * read
olcAccess: to dn.base="" by * read
olcAccess: to * by dn="<%= node['openldap-server'][:rootDN] %>" write


